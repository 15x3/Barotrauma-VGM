<?xml version="1.0" encoding="utf-8"?>
<Items>
<Override>
  <Item name="测试道具" identifier="flashlightTestVGM" category="Equipment" Tags="smallitem,tool,provocative" cargocontaineridentifier="metalcrate" Scale="0.5" impactsoundtag="impact_metal_light" >
    <InventoryIcon texture="Content/Items/InventoryIconAtlas.png" sourcerect="704,320,64,64" origin="0.5,0.5" />
    <Sprite texture="Content/Items/Tools/tools.png" sourcerect="293,185,49,18" depth="0.55" origin="0.5,0.5" />
    <Body width="48" height="15" density="15" />
    <Holdable slots="Any,RightHand,LeftHand,Head" holdpos="30,-50" aimpos="60,0" handle1="-20,0" msg="ItemMsgPickUpSelect">
      <StatusEffect type="OnActive" targettype="Contained" Condition="-0.2">
        <RequiredItem items="mobilebattery" type="Contained" />
      </StatusEffect>
      <LightComponent LightColor="0.5,0.5,0.5,1.0" directional="true" Flicker="0.02" range="800" powerconsumption="10" IsOn="true">
        <LightTexture texture="Content/Lights/lightcone.png" origin="0.0, 0.5" size="1.0,1.0" />
        <IsActive targetcontaineditem="true" condition="gt 1.0"/>
      </LightComponent>
      <LightComponent LightColor="0.5,0.5,0.5,1.0" directional="true" range="800" powerconsumption="10" IsOn="true" flicker="0.8" flickerspeed="1.0" pulsefrequency="0.1" pulseamount="0.5">
        <LightTexture texture="Content/Lights/lightcone.png" origin="0.0, 0.5" size="1.0,1.0" />
        <IsActive targetcontaineditem="true" condition="lte 1.0"/>
      </LightComponent>
    </Holdable>
    <ItemContainer capacity="1" maxstacksize="1" hideitems="true" containedstateindicatorstyle="battery">
      <SlotIcon slotindex="0" texture="Content/UI/StatusMonitorUI.png" sourcerect="128,448,64,64" origin="0.5,0.5" />
      <Containable items="mobilebattery">
        <StatusEffect type="OnContaining" targettype="This" Voltage="1.0" setvalue="true" />
      </Containable>
    </ItemContainer>
  </Item>

  <Item name="测试枪" identifier="smgTestVGM" category="Weapon" cargocontaineridentifier="metalcrate" tags="smallautoweapon,smallitem,weapon,gun,gunsmith,provocativetohumanai,mountableweapon" Scale="0.5" impactsoundtag="impact_metal_light">
    <InventoryIcon texture="Content/Items/InventoryIconAtlas.png" sourcerect="832,830,64,64" origin="0.5,0.5" />
    <Sprite texture="Content/Items/Weapons/weapons_new.png" sourcerect="0,121,144,80" depth="0.55" origin="0.5,0.5" />
    <Body width="140" height="60" density="25" />
    <Holdable slots="Any,RightHand+LeftHand" controlpose="true" holdpos="40,-10" aimpos="45,-10" handle1="-30,-15" handle2="26,5" holdangle="-35" msg="ItemMsgPickUpSelect" >
    <!-- 枪托对移动速度的修改代码,如需察看完整的配件系统请移步至下方大块注释区域 -->
      <StatusEffect type="OnActive" target="Character" SpeedMultiplier="0.4" setvalue="true" >
        <RequiredItem items="light" type="Contained" />
      </StatusEffect>
    <!-- 移动速度修改代码结束 -->
    </Holdable>
    <RangedWeapon reload="0.19" weapondamagemodifier="1.3" penetration="0.15" holdtrigger="true" barrelpos="64,9" spread="10" unskilledspread="16" combatPriority="80" drawhudwhenequipped="true" crosshairscale="0.2">
      <Crosshair texture="Content/Items/Weapons/Crosshairs.png" sourcerect="0,256,256,256" />
      <CrosshairPointer texture="Content/Items/Weapons/Crosshairs.png" sourcerect="256,256,256,256" />
      <StatusEffect type="OnUse" target="This">
        <ParticleEmitter particle="casingfirearm" particleamount="1" anglemin="90" anglemax="150" velocitymin="50" velocitymax="250" CopyEntityAngle="true" />
        <Explosion range="50.0" force="1.5" shockwave="false" smoke="false" flames="false" sparks="false" underwaterbubble="false" camerashake="115.0" />
      </StatusEffect>

      <StatusEffect type="OnUse" target="Contained">
        <Use />
      </StatusEffect>

      <StatusEffect type="OnSecondaryUse" target="This" Condition="-0.1" stackable="true" disabledeltatime="true" setvalue="false" >
        <RequiredItem items="flashlight" type="Contained" />
      </StatusEffect>
      <RequiredItems items="smgammo" type="Contained" msg="ItemMsgAmmoRequired" />
      <RequiredSkill identifier="weapons" level="50" />
    </RangedWeapon>
    <ItemContainer capacity="1" maxstacksize="1" hideitems="false" containedstateindicatorslot="0" containedstateindicatorstyle="bullet" containedspritedepth="0.56">

<!-- ItemContainer的内容是VGM实现的关键:所有配件的效果都写在ItemContainer当中:可以插的类型\插入后的数值等等 -->

<!-- 很遗憾!配件的效果必须写在枪械当中, 坏处是你做VGM枪时必须在父类(枪械)上设定好子类(配件)的数值,这样你的武器代码会又臭又长,好处则是你可以顺带给每一把枪可以安装的配件来个深度定制,在细节上做出点东西-->
<!-- 我并不是没有想过把它们写进子物品里,但是考虑到statusEffect不支持乘除(只能加减属性),而且每把枪属性各不相同,这个程序上确实更优雅的组织方法很遗憾在这里没法实现. -->

      <Containable items="smgammo,smallMagVGM,bigMagVGM,drumMagVGM" hide="false" itempos="4,-10" rotation="-30" />
      <!-- 你需要在这里修改SlotIcon -->
      <SlotIcon slotindex="0" texture="Content/UI/StatusMonitorUI.png" sourcerect="256,448,64,64" origin="0.5,0.5" />
      <SlotIcon slotindex="1" texture="Content/UI/StatusMonitorUI.png" sourcerect="320,448,64,64" origin="0.5,0.5" />
      <SlotIcon slotindex="2" texture="%ModDir%/UI/icons.png" sourcerect="192,0,64,64" origin="0.5,0.5" />
      <SlotIcon slotindex="3" texture="%ModDir%/UI/icons.png" sourcerect="256,0,64,64" origin="0.5,0.5" />
      <SlotIcon slotindex="4" texture="%ModDir%/UI/icons.png" sourcerect="64,0,64,64" origin="0.5,0.5" />
      <SlotIcon slotindex="5" texture="%ModDir%/UI/icons.png" sourcerect="128,0,64,64" origin="0.5,0.5" />
      <!-- 下配件 -->
      <!-- 影响持握动作(holdangle和holdpos) ,请注意,这里我打开了setvalue,因为它们本身不涉及数值加减-->
      <!-- 思路是加装握把后,减少玩家的反应时间(不需要举枪再打,因为holdangle已经是举枪/半举枪状态,可以直接跳到瞄准环节) -->
      <SubContainer capacity="1" maxstacksize="1">
      <!-- 在Containable当中修改对应的物品和位置 -->
        <Containable items="smallAccessoryVGM,bigAccessoryVGM,light" hide="false" itempos="22,-1" setactive="true" >
            <StatusEffect type="OnInserted" target="This" holdangle="20" disabledeltatime="true" setvalue="true" >
            <!-- holdangle一般来讲-10和20就行,射击角度通常是0左右(一般没人第一枪打腿吧?) -->
              <RequiredItem items="light" type="Contained" />
            </StatusEffect> 
            <StatusEffect type="OnRemoved" target="This" holdangle="-35" disabledeltatime="true" setvalue="true" />
        </Containable>
      </SubContainer>
      <!-- 握把 -->
      <!-- 我本来想做的,但是握把的贴图效果叠到武器上,看着比现在的枪托还逆天.所以算了不做了 -->
      <SubContainer capacity="1" maxstacksize="1">
        <Containable items="smallHandVGM,bigHandVGM" hide="false" itempos="22,-1" setactive="true" >
            <StatusEffect type="OnInserted" target="This" reload="-0.15" disabledeltatime="true" crosshairscale="0.5" setvalue="false" />
            <StatusEffect type="OnRemoved" target="This" reload="0.15" disabledeltatime="true" crosshairscale="-0.5" setvalue="false" />
        </Containable>
      </SubContainer>
      <!-- 枪口 -->
      <!-- 影响伤害\穿透能力\枪管位置\枪声大小,不过枪声不能写在这里,最好写在前面 -->
      <!-- 枪管位置一般只需要在X轴上写成 "原版枪管+你的配件像素长度" 即可,如果需要取消枪火请移步枪火的内容上. -->
      <!-- 注意了:所有涉及属性的都要写stackable="true"和setvalue="false",至于disabledeltatime="true",我觉得还是加上为妙 -->
      <!-- 我并不是没有想过让它也影响散布,但是至于为什么不行,具体请看开发日志 -->
      <SubContainer capacity="1" maxstacksize="1">
        <Containable items="smallMuzzleVGM,bigMuzzleVGM" hide="false" itempos="22,-1" setactive="true" >
            <StatusEffect type="OnInserted" target="This" weapondamagemodifier="6" stackable="true" barrelpos="100,9" disabledeltatime="true" setvalue="false" >
              <RequiredItem items="muzzleTemplateVGM" type="Contained" />
            </StatusEffect> 
            <!-- 重置属性 -->
            <StatusEffect type="OnRemoved" target="This" weapondamagemodifier="1.3" penetration="0.15"  barrelpos="64,9" disabledeltatime="true" setvalue="true" />
        </Containable>
      </SubContainer>
      <!-- 枪托 -->
      <!-- 影响移动速度/散布/视角摇晃 -->
      <!-- 这里只控制散布,视角摇晃得写在Exploration,移动速度需要写在Holdable当中. -->
      <SubContainer capacity="1" maxstacksize="1">
        <Containable items="smallStockVGM,bigStockVGM" hide="false" itempos="22,-1" setactive="true" >
            <StatusEffect type="OnInserted" target="This" spread="-15.0" unskilledspread="-15.0" stackable="true" disabledeltatime="true" setvalue="false" >
              <RequiredItem items="stockTemplateVGM" type="Contained" />
            </StatusEffect>
            <StatusEffect type="OnRemoved" target="This" spread="15.0" unskilledspread="-15.0" stackable="true" disabledeltatime="true" setvalue="false" />
        </Containable>
      </SubContainer>
      <!-- 上挂件 -->
      <!-- 影响瞄准距离(cameraaimoffset)和准星大小,手电筒和激光被安装在此时会导致准星被禁用(crosshairscale="0.0") -->
      <!-- cameraaimoffset和crosshairscale只能使用setvalue来设定 -->
      <SubContainer capacity="1" maxstacksize="1">
        <Containable items="smallScopeVGM,bigScopeVGM,light" hide="false" itempos="22,-1" setactive="true" >
            <StatusEffect type="OnInserted" target="This" cameraaimoffset="500" crosshairscale="0.2" disabledeltatime="true" setvalue="true" >
              <RequiredItem items="scopeTemplateVGM" type="Contained" />
            </StatusEffect>
            <StatusEffect type="OnInserted" target="This" cameraaimoffset="0" drawhudwhenequipped="false" disabledeltatime="true" setvalue="true" >
              <RequiredItem items="flashlight" type="Contained" />
              <!-- <DrawHUDWhenEquipped target="This" setvalue="true">false</DrawHUDWhenEquipped> -->
            </StatusEffect>

            <StatusEffect type="OnRemoved" target="This" cameraaimoffset="0" reload="0.15" disabledeltatime="true" crosshairscale="0.5" setvalue="true" />
        </Containable>
      </SubContainer>
    </ItemContainer>
  </Item>
</Override>
</Items>